<!DOCTYPE html>
<html lang="en-US">
<meta charset="UTF-8">
<head>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.5/d3.min.js"></script>
    <style type="text/css">
        .rex {
            border-style: solid;
            border-width: 1px;
            font: 10px sans-serif;
            shape-rendering: crispEdges;
        }

        .tex {
            font-family: sans-serif;
            font-size: 10px;
            fill: black;
            text-anchor: start;
        }

        .axis text {
            font: 10px sans-serif;
        }

        .axis path,
        .axis line {
            fill: none;
            stroke: none;
            shape-rendering: crispEdges;
        }

        .q0-9 {
            border-style: solid;
            border-width: 1px;
            stroke: rgb(255,0,0);
            fill: rgba(247, 251, 255, 0.2);
        }

        .q1-9 {
            border-style: solid;
            border-width: 1px;
            stroke: rgb(255,0,0);
            fill: rgb(222,235,247);
        }

        .q2-9 {
            border-style: solid;
            border-width: 1px;
            stroke: rgb(255,0,0);
            fill: rgb(198,219,239);
        }

        .q3-9 {
            border-style: solid;
            border-width: 1px;
            stroke: rgb(255,0,0);
            fill: rgb(158,202,225);
        }

        .q4-9 {
            border-style: solid;
            border-width: 1px;
            stroke: rgb(255,0,0);
            fill: rgb(107,174,214);
        }

        .q5-9 {
            border-style: solid;
            border-width: 1px;
            stroke: rgb(255,0,0);
            fill: rgb(66,146,198);
        }

        .q6-9 {
            border-style: solid;
            border-width: 1px;
            stroke: rgb(0,255,100);
            fill: rgba(33,113,181,.2);
        }

        .q7-9 {
            border-style: solid;
            border-width: 1px;
            stroke: rgb(0,255,125);
            fill: rgba(8,81,156,0.2);
        }

        .q8-9 {
            border-style: solid;
            border-width: 1px;
            stroke: rgb(255,0,0);
            fill: rgb(8,48,107);
        }
    </style>
</head>
<body>
    <script>
        var maxRow = 1048576;
        //var maxRow = 10000;
        //var maxCol = 1000;
        var maxCol = 16384;
        var margin = {top: 20, right: 20, bottom: 30, left: 40};
        var width = 800 - margin.left - margin.right;
        var height = 800 - margin.top - margin.bottom;

        var ds = {
            "type": "temporalBindingCollection",
            "temporalBindings": []
        };

        function getExcelColumnName(columnNumber){
            var dividend = columnNumber;
            var columnName = "";
            var modulo;
            while (dividend > 0)
            {
                modulo = (dividend - 1) % 26;
                columnName = String.fromCharCode(65 + modulo).toString() + columnName;
                dividend = Math.floor((dividend - modulo) / 26);
            }
            return  columnName;
        }

        function getA1Address(randomTopLeftCol, randomTopLeftRow, randomRowCount, randomColCount){
          var address = "";
          var startCol = getExcelColumnName(randomTopLeftCol);
          var startRow = randomTopLeftRow.toString();
          var endCol = getExcelColumnName(randomTopLeftCol + randomColCount);
          var endRow = (randomTopLeftRow + randomRowCount).toString();
          address = startCol + startRow + ":" + endCol + endRow;
          return address;
        }

        function createTemporalBinding(index){
            var temporalBinding = {
              "timeCreated": Date(),
              "coordinates": {}
            };

            // xl constrained random row
            var randomTopLeftRow = Math.floor((Math.random() * maxRow) + 1);
            // xl constrained random row extent
            var randomRowCount = Math.min((maxRow - randomTopLeftRow), Math.floor((Math.random() * (maxRow - randomTopLeftRow))+1));
            // xl constrained random column;
            var randomTopLeftCol = Math.floor((Math.random() * maxCol) + 1);
            // xl constrained random column extent;
            var randomColCount = Math.min((maxCol - randomTopLeftCol), Math.floor((Math.random() * (maxCol - randomTopLeftCol))+1));

            temporalBinding.coordinates.x = randomTopLeftCol;
            temporalBinding.coordinates.y = randomTopLeftRow;
            temporalBinding.coordinates.w = randomColCount;
            temporalBinding.coordinates.h = randomRowCount;

            console.log(temporalBinding);
            temporalBinding.a1Address = getA1Address(randomTopLeftCol, randomTopLeftRow, randomRowCount, randomColCount);
            return temporalBinding;
        }

        //var i = 0;
        //for(i=0;i<10;i++){
        //  ds.temporalBindings.push(createTemporalBinding(i));
        //}

        var temporalBinding = {
            "timeCreated": Date(),
              "coordinates": {
                "x": 1,
                "y": 1,
                "w": 20,
                "h": 10
              },
            "a1Address": "Sheet1!A1:T10"
        };
        var temporalBinding2 = {
            "timeCreated": Date(),
              "coordinates": {
                "x": 1,
                "y": 1,
                "w": 5,
                "h": 15
              },
            "a1Address": "Sheet2!A1:E15"
        };
        var temporalBinding3 = {
            "timeCreated": Date(),
              "coordinates": {
                "x": 1,
                "y": 1,
                "w": 20,
                "h": 15
              },
            "a1Address": "Workbook A1:T15"
        };

        ds.temporalBindings.push(temporalBinding);
        ds.temporalBindings.push(temporalBinding2);
        ds.temporalBindings.push(temporalBinding3);


        console.log(ds);

        function quantize(h, w) {
            //return "q" + Math.min(8, ~~(d * 9 / 12)) + "-9";
            if ((h + w) == 35) {
                return "q0-9";
            } else if ((h + w) == 30) {
                return "q6-9";
            } else {
                return "q7-9";
            }
            //return "q" + Math.floor((Math.random() * 8) + 1) + "-9";
        }

        var x = d3.scale.linear()
            .range([0, width])
            //.domain([1, 30]);
            .domain([1,maxCol]);
            //.domain([0,d3.max(ds.temporalBindings, function(d) {return d.coordinates.x + d.coordinates.w;})]);

        var y = d3.scale.linear()
            .range([0, height])
            //.domain([1, 40]);
            .domain([1,maxRow]);
            //.domain([d3.max(ds.temporalBindings, function(d) { return d.coordinates.y + d.coordinates.h;}),0]);

        var xAxis = d3.svg.axis()
                .scale(x)
                .orient("top")
                .ticks(10)
                .tickSize(0.2);

        var yAxis = d3.svg.axis()
                .scale(y)
                .orient("left")
                .ticks(10)
                .tickSize(1);

        var zoom = d3.behavior.zoom()
            .scaleExtent([1, 10])
            .on("zoom", zoomed);

        var svg = d3.select("body").append("svg")
            .attr("class","rex")
            .attr("width",width + margin.left + margin.right)
            .attr("height",height  + margin.top + margin.bottom)
        .append("g")
            .attr("transform", "translate(" + (margin.left  + margin.right) + "," + margin.top + ")")
            .call(zoom);

        var container = svg.append("g");

        var rex = container.append("g")
            .selectAll("rect")
                .data(ds.temporalBindings);

        rex.exit().remove();
        rex.enter().append("rect")
                .attr("x", function(d) {return x(d.coordinates.x);})
                .attr("y", function(d) {return y(d.coordinates.y);})
                .attr("width", function(d){return x(d.coordinates.w);})
                .attr("height", function(d){return y(d.coordinates.h);})
                .attr("class", function(d){return quantize(d.coordinates.h, d.coordinates.w);});

        var rect = svg.append("rect")
            .attr("width", width)
            .attr("height", height)
            .style("fill", "none")
            .style("pointer-events", "all");


         var tex = container.append("g")
            .selectAll("text")
                .data(ds.temporalBindings);

         tex.exit().remove();
         tex.enter().append("text")
                .text(function(d){return d.a1Address;})
                .attr("x", function(d){return x(d.coordinates.x);})
                .attr("y", function(d){return y(d.coordinates.y);})
                .attr("class","tex");

        container.append("g")
            .attr("class", "x axis")
            .call(xAxis);

        container.append("g")
            .attr("class", "y axis")
            .call(yAxis);

        function zoomed(){
            svg.select("x axis").call(xAxis);
            svg.select("y axis").call(yAxis);
            container.attr("transform", "translate(" + d3.event.translate + ")scale(" + d3.event.scale + ")");
        }


    </script>
</body>
</html>